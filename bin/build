#!/bin/sh

repo=dobe

selfPath=$(readlink -f "$(command -v "$0")") || exit
selfDir=$(dirname "$selfPath")
dobeRoot=$(dirname "$selfDir")
versionDir=${selfDir}/version
(
	cd "$dobeRoot" || exit
	version=$(
		"${versionDir}/increment" \
			"$versionDir" \
			"${selfPath#"${dobeRoot}/"}" \
			docker/*
	)

	docker build \
		-t $repo \
		-t $repo:v"$version" \
		docker
)
